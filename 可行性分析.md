## 《大语言模型广告拍卖机制的关键技术研究》可行性分析

### 1 理论实验

为验证申请人对项目中提出的多LLM社区协同与竞争均衡求解的可行性，初步考虑广告商规模为2的两两之间LLM广告位竞拍，以此证明竞价均衡策略的存在性。均衡存在性的证明保证了本项目研究的可行性。

定理：两个广告商在竞争LLM广告索引过程中存在均衡竞价策略$S^*$。

证明：本项目定义广告商集合为$ADV = \left\{ 1,2,\cdots,n \right\}$，任取两个广告商$i$和$j$，二者对LLM广告索引的估值分别为$v_{i}$和$v_{j}$，报价分别为$b_{i}$和$b_{j}$，根据贝特兰德模型[^1]，两个广告商的需求广告索引数量为$q\left( b_{i},b_{j} \right) = a - b_{i} + cb_{j}$，其中，$c$为市场价格系数，此时广告商$i$的收益函数表示为$\pi_{i}\left( b_{i},b_{j} \right) = q\left( b_{i},b_{j} \right)\left( v_{i} - b_{i} \right) = \left( a - b_{i} + cb_{j} \right)\left( v_{i} - b_{i} \right)$。针对变量$p_{i}$，对广告商收益函数进行求导，可得$\partial\pi_{i}\left( b_{i},b_{j} \right)/\partial b_{i} = - a - v_{i} + 2b_{i} - cb_{j}$。令$\partial\pi_{i}\left( b_{i},b_{j} \right)/\partial b_{i} = 0$，则$b_{i} = (a + v_{i} + cb_{j})/2$。同理，对于广告商$j$，其竞价博弈均衡报价为$b_{j} = ( - a + cv_{j} + b_{i})/2c$。因此，可以得到广告商报价$b_{i}$和$b_{j}$报价关系如图所示。

<img src="/figure/fig1.png" alt="image-20240223184020867" style="zoom: 25%;" />

从图可以看出，$P$点为两个广告商报价的均衡点，即当广告商$i$的报价$b_{i}^{*} = (a + cv_{j} + 2v_{i})/3$，广告商$j$的报价$b_{j}^{*} = (2cv_{j} - a + v_{i})/(3c)$时，竞价策略达到均衡状态，此时两个广告商都没有动机改变策略$S^{*} = (b_{i}^{*},b_{j}^{*})$。

本项目通过贝特兰德模型初步验证了在竞争单LLM广告索引时广告商两两之间存在均衡策略，为推广至多广告商竞争多LLM广告索引提供了理论基础，进一步证明了多LLM社区协同与竞争均衡求解的可行性。



### 2 模拟实验

项目申请人进行了模拟性实验探究，用于初步验证申请书所提LLM广告的拍卖机制设计的可行性。模拟实验所用的软件环境是Ubuntu 18.04.5 LTS，Visual Studio Code Developers，Python 3.10；硬件设备是扬州大学朱俊武团队的某台本地主机，相关配置是AMD Ryzen 9 3900X Twelve -Core Processor，RTX 2080Ti，64GB RAM。

#### 2.1 定量分析

##### 2.1.1 实验1

申请书所提LLM广告的排位分配与定价机制性能优于第二价格密封式拍卖和荷兰拍卖，验证了申请者提出的LLM广告拍卖机制中交易和定价机制的有效性。

实验所涉及的用户数、报价信息等数据随机生成，为了减少随机性对实验结果造成的影响，实验在重复执行100次后取社会福利平均值作为每轮的最终结果。本项目从社会福利进行对比分析，所提出的面向LLM的拍卖机制、第二价格密封式拍卖和荷兰拍卖的比较结果如图所示。

<img src="/figure/fig2.png" alt="image-20240223182802531" style="zoom: 67%;" />

实验结果显示三种方法均随广告商和广告位数量的增加，社会福利呈现递增的趋势，但是本项目初步设计的算法社会福利值始终优于第二价格密封式拍卖和荷兰式拍卖，这主要归功于本项目所提注意力模块能够提高模型对输入信息的关注度，有效地聚焦于广告商的估值信息，提高了对市场需求的准确感知。而相比荷兰式拍卖，第二价格密封式拍卖由于竞标者支付的价格是第二高的出价，不会因为其自身的出价而影响最终支付的价格，促使出价者更愿意提供准确的估值，因此社会福利表现优于荷兰式拍卖。



##### 2.1.2 实验2

实验所涉及的数据是由阿里巴巴集团提供的包括30个出价智能体一周的完整参竞数据[^2]，包括广告商的预算、对流量的出价和收益、流量的市场价格等信息。在整个投放周期内，智能体对每一条广告流量进行出价，广告平台通过运行广义第二价格拍卖GSP机制，使得在所有流量完成参竞之后，使得所有竞得流量的总价值最大化。本项目是在基于强化学习的广告竞价策略生成方法的基础上进行研究，通过对IQL(Implicit Q-learning)和BC(behavior cloning)基础算法进行验证，并分别从算法的收敛性和总收益方面进行对比分析，以佐证本项目的研究基础。实验性能进行比较的结果如图所示。

<img src="/figure/fig3-1.png" alt="image-20240223183205940" style="zoom:50%;" />

<img src="/figure/fig3-2.png" alt="image-20240223183205940" style="zoom:50%;" />

上图是在IQL算法下，训练损失Q-Loss随训练步数变化的曲线图。下图是在BC算法下，训练损失Loss随训练步数变化的曲线图。其中训练轮数为10000轮，batch为2000。通过训练，IQL算法的得到广告商竞得流量的总价值为117.67，BC算法得到的广告商竞得流量的总价值为123.92。此实验体现了现有基础算法在广告自动竞价方面的可行性，能够基于真实环境下的数据进行训练。模型通过训练后，算法能够在较短时间内得到结果，计算性能较好。



##### 2.1.3 实验3

为了保护用户隐私性，模拟实验涉及到的数据集为随机生成，为了减少数据随机性带来的影响，实验结果均跑了500轮以上。为了验证多LLM社区协同与竞争均衡求解的可行性，本节考虑两个LLM支持的广告竞价策略生成系统，通过分别设置两者间关系为协同和竞争，以此进行社会福利和平台收益的比较。

<img src="/figure/fig4.png" alt="image-20240223183121805" style="zoom: 60%;" />

从左图可看出，合作关系下的LLM所产生的社会福利相较于竞争关系较高，这表明LLM通过合作可以共同追求最大化的整体利益，相比之下，竞争关系会导致资源的争夺和浪费。然而，从右图可看出，完全合作关系下的LLM会显著降低平台收益，而竞争关系下的LLM可以保证更高的收益。本实验表明，为了实现广告主和平台的共赢，有必要在多LLM自动竞价问题中平衡竞争与合作关系。



##### 2.1.4 实验4

模拟实验代码由Prism语言实现，模拟实验涉及3个LLM agents和一个调度器，在每一轮中LLM 都要做出合作或不合作的决定，调度器决定了LLM选择的顺序。在所有LLM都做出决策后，调度器通过均匀选择两名LLM，所选定的两名LLM决定的行动决定博弈结果。

<img src="/figure/fig5.png" alt="img" style="zoom:67%;" />

<img src="/figure/fig6.png" alt="2" style="zoom:67%;" />

博弈展开的10轮路径如图所示，其中s1,s2和s3分别表示 LLM agent1、LLM agent 2和LLM agent3的策略选择，当s=1时代表合作，当s=2时代表不合作。协调器决定博弈的轮次（turn）和结果（outcome）。当执行到第turn=7时outcome=1表示所有LLM agents都决策完毕并行动，随后协调器随机选择agent2和agent3形成联盟。在联盟12和联盟123中，若agent2和agent3合作则分别奖励5和10 ，如图所示，奖励能有效鼓励agents采取合作策略。

<img src="/figure/fig7.png" alt="1" style="zoom: 67%;" />

当调整agents不合作的奖励之后，如图所示，三个LLM agents之间均采取不合作策略（s1=s2=s3=2），当执行到第turn=7时，所有agents都决策完毕并行动，随后协调器随机选择选择agent1和agent3形成联盟，由于此时系统对agents之间不合作行为奖励，所以不论处于何种联盟奖励中，agent1和agent3均选择不合作策略。



#### 2.2 定性分析

##### 2.2.1 实验5

实验设置赢者广告商为4，广告商来源通过谷歌、百度和大众点评等网站中抽取的实体，模型在每轮用户提问都会重新选择实体，通过内置的拍卖模块决定赢者顺序，结果如图所示。

<img src="/figure/fig8.png" alt="图片2" style="zoom: 50%;" />

实验结果显示有四家餐厅和两段基础回复组成，推荐的广告符合常识性认知，是当地比较有名且符合地方特色的餐厅，并且对四家餐厅出处进行了罗列，方便用户点击查询。针对每家餐厅，详细描述了每家餐厅的特色菜。在基础回复部分对用户查询的“扬州”和“餐厅”实体分别进行了扩展，按照用户的偏好，描述了“扬州”实体的背景，在结尾总结并推荐了“扬州”和“餐厅”这两个实体。



### 参考文献

[^1]: 在贝特兰德模型中，博弈双方以产品价格作为决策变量，其需求广告索引函数呈线性关系。该模型通过求解纳什均衡确定出价策略，即任何一家公司都没有动机改变自身价格以获得更高的利益。
[^2]: https://alimama-competition.oss-cn-zhangjiakou.aliyuncs.com/simul_bidding_env/data/log.csv
